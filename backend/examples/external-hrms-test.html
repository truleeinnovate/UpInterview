<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>External HRMS Test Application</title>
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .btn {
        background-color: #007bff;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
      }
      .btn:hover {
        background-color: #0056b3;
      }
      .btn-success {
        background-color: #28a745;
      }
      .btn-success:hover {
        background-color: #1e7e34;
      }
      .response {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
        white-space: pre-wrap;
        font-family: monospace;
      }
      .success {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .skills-container {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 15px;
      }
      .skill-item {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }
      .skill-item input {
        flex: 1;
      }
      .btn-remove {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
      }
      .config-section {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      .two-column {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      /* Make textareas full width */
      textarea {
        width: 100%;
        min-height: 100px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        resize: vertical;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ External HRMS Test Application</h1>

      <div class="tabs">
        <button class="tab-btn active" data-tab="candidate">Candidate</button>
        <button class="tab-btn" data-tab="position">Position</button>
        <button class="tab-btn" data-tab="bulk">Bulk Operations</button>
      </div>

      <div class="config-section">
        <h3>‚öôÔ∏è Configuration</h3>
        <div class="form-group">
          <label for="baseUrl">API Base URL:</label>
          <input
            type="text"
            id="baseUrl"
            value="http://localhost:5000/external"
          />
        </div>
        <div class="form-group">
          <label for="apiKey">API Key:</label>
          <input type="text" id="apiKey" value="your_api_key_here" />
        </div>
      </div>

      <!-- Single Candidate Form -->
      <div id="candidate-tab" class="tab-content active">
        <form id="candidateForm">
          <h3>üë§ Candidate Information</h3>
          <div class="two-column">
            <div class="form-group">
              <label for="firstName">First Name *</label>
              <input type="text" id="firstName" required />
            </div>
            <div class="form-group">
              <label for="lastName">Last Name *</label>
              <input type="text" id="lastName" required />
            </div>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="email">Email *</label>
              <input type="email" id="email" required />
            </div>
            <div class="form-group">
              <label for="phone">Phone (10 digits) *</label>
              <input type="text" id="phone" pattern="[0-9]{10}" required />
            </div>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="countryCode">Country Code *</label>
              <input type="text" id="countryCode" value="+91" required />
            </div>
            <div class="form-group">
              <label for="technology">Primary Technology *</label>
              <input type="text" id="technology" value="JavaScript" required />
            </div>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="currentRole">Current Role *</label>
              <input type="text" id="currentRole" required />
            </div>
            <div class="form-group">
              <label for="higherQualification">Higher Qualification *</label>
              <input type="text" id="higherQualification" required />
            </div>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="currentExperience"
                >Current Experience (years) *</label
              >
              <input type="number" id="currentExperience" min="0" required />
            </div>
            <div class="form-group">
              <label for="relevantExperience"
                >Relevant Experience (years) *</label
              >
              <input type="number" id="relevantExperience" min="0" required />
            </div>
          </div>

          <div class="form-group">
            <label for="university">University/College</label>
            <input type="text" id="university" />
          </div>

          <div class="form-group">
            <label>Skills *</label>
            <div class="skills-container">
              <div id="skillsList">
                <div class="skill-item">
                  <input
                    type="text"
                    placeholder="Skill name"
                    class="skill-name"
                    value="JavaScript"
                  />
                  <input
                    type="text"
                    placeholder="Experience"
                    class="skill-experience"
                    value="2 years"
                  />
                  <input
                    type="text"
                    placeholder="Expertise level"
                    class="skill-expertise"
                    value="Intermediate"
                  />
                  <button
                    type="button"
                    class="btn-remove"
                    onclick="removeSkill(this)"
                  >
                    Remove
                  </button>
                </div>
              </div>
              <button type="button" class="btn" onclick="addSkill()">
                + Add Skill
              </button>
            </div>
          </div>

          <button type="submit" class="btn btn-success">
            üöÄ Create Candidate
          </button>
        </form>
      </div>

      <!-- Single Position Form -->
      <div id="position-tab" class="tab-content">
        <form id="positionForm">
          <h3>üè¢ Position Information</h3>
          <div class="two-column">
            <div class="form-group">
              <label for="positionTitle">Position Title *</label>
              <input type="text" id="positionTitle" required />
            </div>
            <div class="form-group">
              <label for="department">Department *</label>
              <input type="text" id="department" required />
            </div>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="location">Location *</label>
              <input type="text" id="location" required />
            </div>
            <div class="form-group">
              <label for="employmentType">Employment Type *</label>
              <select id="employmentType" required>
                <option value="full-time">Full Time</option>
                <option value="part-time">Part Time</option>
                <option value="contract">Contract</option>
                <option value="internship">Internship</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="description">Job Description *</label>
            <textarea id="description" rows="4" required></textarea>
          </div>

          <div class="form-group">
            <label for="requirements">Requirements *</label>
            <textarea
              id="requirements"
              rows="4"
              placeholder="Enter requirements, one per line"
              required
            ></textarea>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="minExperience">Min Experience (years) *</label>
              <input type="number" id="minExperience" min="0" required />
            </div>
            <div class="form-group">
              <label for="maxExperience">Max Experience (years)</label>
              <input type="number" id="maxExperience" min="0" />
            </div>
          </div>

          <div class="form-group">
            <label for="skills">Required Skills (comma separated)</label>
            <input
              type="text"
              id="skills"
              placeholder="e.g., JavaScript, React, Node.js"
            />
          </div>

          <div class="form-group">
            <label for="status">Status *</label>
            <select id="status" required>
              <option value="open">Open</option>
              <option value="closed">Closed</option>
              <option value="on-hold">On Hold</option>
            </select>
          </div>

          <button type="submit" class="btn btn-primary">Create Position</button>
        </form>
      </div>

      <!-- Bulk Operations Tab -->
      <div id="bulk-tab" class="tab-content">
        <div class="bulk-section">
          <h3>üì¶ Bulk Candidate Creation</h3>
          <div class="form-group">
            <label for="bulkCandidates">Paste JSON array of candidates</label>
            <textarea
              id="bulkCandidates"
              rows="8"
              class="code-json"
              placeholder='[
  {
    "firstName": "John",
    "lastName": "Doe",
    "email": "john.doe@example.com",
    "phone": "1234567890",
    "countryCode": "+91",
    "currentRole": "Software Engineer",
    "technology": "JavaScript",
    "skills": [
      {"skill": "JavaScript", "experience": "3 years", "expertise": "Intermediate"}
    ]
  }
]'
            ></textarea>
          </div>
          <button id="bulkCandidatesBtn" class="btn btn-primary">
            Upload Candidates
          </button>
        </div>

        <div class="bulk-section">
          <h3>üì¶ Bulk Position Creation</h3>
          <div class="form-group">
            <label for="bulkPositions">Paste JSON array of positions</label>
            <textarea
              id="bulkPositions"
              rows="8"
              class="code-json"
              placeholder='[
  {
    "title": "Senior Frontend Developer",
    "department": "Engineering",
    "location": "Remote",
    "employmentType": "full-time",
    "description": "We are looking for a skilled Frontend Developer...",
    "requirements": "3+ years of experience with React\nStrong JavaScript skills...",
    "minExperience": 3,
    "status": "open"
  }
]'
            ></textarea>
          </div>
          <button id="bulkPositionsBtn" class="btn btn-primary">
            Upload Positions
          </button>
        </div>
      </div>

      <div class="response" id="response"></div>

      <div
        class="response"
        id="apiResponse"
        style="display: none; margin-top: 20px"
      >
        <h3>API Response</h3>
        <pre id="responseContent"></pre>
      </div>
    </div>

    <script>
      // Tab switching
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          // Remove active class from all buttons and content
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((c) => c.classList.remove("active"));

          // Add active class to clicked button and corresponding content
          btn.classList.add("active");
          document
            .getElementById(`${btn.dataset.tab}-tab`)
            .classList.add("active");
        });
      });

      // Initialize Select2 for skills
      $(document).ready(function () {
        $("#skills").select2({
          tags: true,
          tokenSeparators: [",", " "],
          placeholder: "Add skills (comma separated)",
        });
      });

      function addSkill() {
        const skillsList = document.getElementById("skillsList");
        const skillItem = document.createElement("div");
        skillItem.className = "skill-item";
        skillItem.innerHTML = `
                <input type="text" placeholder="Skill name" class="skill-name" required>
                <input type="text" placeholder="Experience" class="skill-experience" required>
                <input type="text" placeholder="Expertise level" class="skill-expertise" required>
                <button type="button" class="btn-remove" onclick="removeSkill(this)">Remove</button>
            `;
        skillsList.appendChild(skillItem);
      }

      function removeSkill(button) {
        const skillsList = document.getElementById("skillsList");
        if (skillsList.children.length > 1) {
          button.parentElement.remove();
        } else {
          alert("At least one skill is required!");
        }
      }

      function getSkills() {
        const skills = [];
        const skillItems = document.querySelectorAll(".skill-item");
        skillItems.forEach((item) => {
          const name = item.querySelector(".skill-name").value;
          const experience = item.querySelector(".skill-experience").value;
          const expertise = item.querySelector(".skill-expertise").value;
          if (name && experience && expertise) {
            skills.push({ skill: name, experience, expertise });
          }
        });
        return skills;
      }

      function showResponse(data, isSuccess = true) {
        const responseDiv = document.getElementById("response");
        responseDiv.className = `response ${isSuccess ? "success" : "error"}`;
        responseDiv.textContent = JSON.stringify(data, null, 2);
      }

      async function createCandidate(candidateData) {
        const baseUrl = document.getElementById("baseUrl").value;
        const apiKey = document.getElementById("apiKey").value;

        try {
          const response = await fetch(`${baseUrl}/candidates`, {
            method: "POST",
            headers: {
              "X-API-Key": apiKey,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(candidateData),
          });

          const data = await response.json();

          if (response.ok) {
            showResponse(data, true);
            console.log("‚úÖ Candidate created successfully:", data);
          } else {
            showResponse(data, false);
            console.error("‚ùå Error creating candidate:", data);
          }
        } catch (error) {
          showResponse({ error: error.message }, false);
          console.error("‚ùå Network error:", error);
        }
      }

      async function testGetCandidates() {
        const baseUrl = document.getElementById("baseUrl").value;
        const apiKey = document.getElementById("apiKey").value;

        console.log("baseUrl", baseUrl);
        console.log("apiKey", apiKey);

        try {
          const response = await fetch(`${baseUrl}/candidates`, {
            method: "GET",
            headers: {
              "X-API-Key": apiKey,
            },
          });

          const data = await response.json();

          if (response.ok) {
            showResponse(data, true);
            console.log("‚úÖ Candidates retrieved:", data);
          } else {
            showResponse(data, false);
            console.error("‚ùå Error fetching candidates:", data);
          }
        } catch (error) {
          showResponse({ error: error.message }, false);
          console.error("‚ùå Network error:", error);
        }
      }

      function clearForm() {
        document.getElementById("candidateForm").reset();
        document.getElementById("firstName").value = "";
        document.getElementById("lastName").value = "";
        document.getElementById("email").value = "";
        document.getElementById("phone").value = "";
        document.getElementById("currentRole").value = "";
        document.getElementById("higherQualification").value = "";
        document.getElementById("currentExperience").value = "";
        document.getElementById("relevantExperience").value = "";
        document.getElementById("university").value = "";
        document.getElementById("response").textContent = "";
      }

      // Single Candidate Form Submission
      document
        .getElementById("candidateForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const candidateData = {
            FirstName: document.getElementById("firstName").value,
            LastName: document.getElementById("lastName").value,
            Email: document.getElementById("email").value,
            Phone: document.getElementById("phone").value,
            CountryCode: document.getElementById("countryCode").value,
            CurrentRole: document.getElementById("currentRole").value,
            HigherQualification: document.getElementById("higherQualification")
              .value,
            CurrentExperience: parseInt(
              document.getElementById("currentExperience").value
            ),
            RelevantExperience: parseInt(
              document.getElementById("relevantExperience").value
            ),
            UniversityCollege:
              document.getElementById("university").value || undefined,
            Technology: document.getElementById("technology").value,
            skills: getSkills(),
          };

          await createCandidate(candidateData);
        });

      // Set default values for testing
      window.addEventListener("load", () => {
        document.getElementById("firstName").value = "Test";
        document.getElementById("lastName").value = "Candidate";
        document.getElementById("email").value = "test.candidate@example.com";
        document.getElementById("phone").value = "6303040683";
        document.getElementById("currentRole").value = "Software Developer";
        document.getElementById("higherQualification").value =
          "Bachelor of Science";
        document.getElementById("currentExperience").value = "3";
        document.getElementById("relevantExperience").value = "2";
        document.getElementById("university").value = "Test University";
      });

      // Position Form Submission
      document
        .getElementById("positionForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const positionData = {
            title: document.getElementById("positionTitle").value,
            department: document.getElementById("department").value,
            location: document.getElementById("location").value,
            employmentType: document.getElementById("employmentType").value,
            description: document.getElementById("description").value,
            requirements: document
              .getElementById("requirements")
              .value.split("\n")
              .filter((r) => r.trim() !== ""),
            minExperience: parseInt(
              document.getElementById("minExperience").value
            ),
            maxExperience:
              parseInt(document.getElementById("maxExperience").value) ||
              undefined,
            skills: document
              .getElementById("skills")
              .value.split(",")
              .map((s) => s.trim())
              .filter((s) => s !== ""),
            status: document.getElementById("status").value,
            externalId: `ext_pos_${Date.now()}`,
          };

          await makeApiCall("/positions", "POST", positionData);
        });

      // Bulk Candidates Upload
      document
        .getElementById("bulkCandidatesBtn")
        .addEventListener("click", async () => {
          try {
            const candidates = JSON.parse(
              document.getElementById("bulkCandidates").value
            );
            if (!Array.isArray(candidates) || candidates.length === 0) {
              throw new Error(
                "Please provide a valid JSON array of candidates"
              );
            }
            await makeApiCall("/candidates/bulk", "POST", candidates);
          } catch (error) {
            showApiResponse(
              { error: "Invalid JSON", message: error.message },
              false
            );
          }
        });

      // Bulk Positions Upload
      document
        .getElementById("bulkPositionsBtn")
        .addEventListener("click", async () => {
          try {
            const positions = JSON.parse(
              document.getElementById("bulkPositions").value
            );
            if (!Array.isArray(positions) || positions.length === 0) {
              throw new Error("Please provide a valid JSON array of positions");
            }
            await makeApiCall("/positions/bulk", "POST", positions);
          } catch (error) {
            showApiResponse(
              { error: "Invalid JSON", message: error.message },
              false
            );
          }
        });

      // Generic API call function
      async function makeApiCall(endpoint, method, data) {
        const baseUrl = document.getElementById("baseUrl").value;
        const apiKey = document.getElementById("apiKey").value;

        if (!apiKey) {
          alert("Please enter an API key");
          return;
        }

        try {
          showApiResponse("Sending request...");

          const response = await fetch(`${baseUrl}${endpoint}`, {
            method,
            headers: {
              "Content-Type": "application/json",
              "X-API-Key": apiKey, // Make sure this matches what the backend expects
            },
            body: data ? JSON.stringify(data) : undefined,
          });

          const responseData = await response.json();

          if (!response.ok) {
            throw new Error(responseData.message || "Request failed");
          }

          showApiResponse(responseData, true);
          return responseData;
        } catch (error) {
          console.error("API Error:", error);
          showApiResponse(
            {
              error: "API Request Failed",
              message: error.message,
              details: error.response?.data,
            },
            false
          );
          throw error;
        }
      }

      // Show API response in the UI
      function showApiResponse(data, isSuccess = true) {
        const responseElement = document.getElementById("responseContent");
        const container = document.getElementById("apiResponse");

        try {
          if (typeof data === "string") {
            responseElement.textContent = data;
          } else {
            responseElement.textContent = JSON.stringify(data, null, 2);
          }

          container.style.display = "block";
          container.className = `response ${isSuccess ? "success" : "error"}`;

          // Scroll to response
          container.scrollIntoView({ behavior: "smooth" });
        } catch (error) {
          console.error("Error displaying response:", error);
          responseElement.textContent = "Error displaying response";
          container.className = "response error";
        }
      }
    </script>

    <style>
      /* New styles for the enhanced UI */
      .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #ddd;
      }

      .tab-btn {
        padding: 10px 20px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 16px;
        color: #555;
        transition: all 0.3s;
      }

      .tab-btn:hover {
        color: #007bff;
      }

      .tab-btn.active {
        color: #007bff;
        border-bottom-color: #007bff;
        font-weight: bold;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      .bulk-section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 5px;
      }

      .bulk-section h3 {
        margin-top: 0;
        color: #333;
      }

      .code-json {
        font-family: "Courier New", Courier, monospace;
        font-size: 14px;
        line-height: 1.5;
      }

      .select2-container {
        width: 100% !important;
        margin-bottom: 15px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: "Courier New", Courier, monospace;
        font-size: 14px;
        line-height: 1.5;
        margin: 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  </body>
</html>
